---
- name: "install asdf"
  git: repo="https://github.com/asdf-vm/asdf.git" dest="~/.asdf" update=yes
  become: yes
  become_user: "{{deploy_user}}"


- name: "source asdf in bashrc"
  lineinfile: dest="~/.bash_profile" create=yes line="source ~/.asdf/asdf.sh"
  become: yes
  become_user: "{{deploy_user}}"


- name: register if erlang plugin is installed
  command: "bash -lc 'asdf plugin-list | grep erlang'"
  register: erlang_plugin
  async: 1800
  become: yes
  become_user: "{{deploy_user}}"


- name: add erlang plugin
  when: erlang_plugin.stdout is not defined
  command: "bash -lc 'asdf plugin-add erlang https://github.com/asdf-vm/asdf-erlang.git'"
  async: 1800
  become: yes
  become_user: "{{deploy_user}}"


- name: register if elixir plugin is installed
  command: "bash -lc 'asdf plugin-list | grep elixir'" 
  async: 1800
  register: elixir_plugin
  become: yes
  become_user: "{{deploy_user}}"

- name: add elixir plugin
  when: elixir_plugin.stdout is not defined
  command: "bash -lc 'asdf plugin-add elixir https://github.com/asdf-vm/asdf-elixir.git'" 
  async: 1800
  become: yes
  become_user: "{{deploy_user}}"

- name: register if nodejs plugin is installed
  command: "bash -lc 'asdf plugin-list | grep nodejs'" 
  async: 1800
  register: nodejs_plugin
  become: yes
  become_user: "{{deploy_user}}"

- name: add nodejs plugin
  when: nodejs_plugin.stdout is not defined
  command: "bash -lc 'asdf plugin-add nodejs https://github.com/asdf-vm/asdf-nodejs.git'" 
  async: 1800
  become: yes
  become_user: "{{deploy_user}}"

- name: add nodejs keys to keyring
  command: "bash -lc 'bash ~/.asdf/plugins/nodejs/bin/import-release-team-keyring'"
  async: 1800
  become: yes
  become_user: "{{deploy_user}}"

