---
- name: add postgres repository
  apt_repository: repo="deb http://apt.postgresql.org/pub/repos/apt/ trusty-pgdg main"


- name: add postgres repository key
  apt_key: url="https://www.postgresql.org/media/keys/ACCC4CF8.asc"


- name: install postgres & libpq-dev & pip
  package: name="{{ item }}" update_cache=yes state=present
  with_items:
    - python-dev
    - postgresql-9.4
    - libpq-dev
    - python-pip


- name: install psycopg2 python module
  pip: name=psycopg2


- name: create postgres user for deployer
  postgresql_user:
    name: "{{ deployer }}"
    password: "{{ database_password }}"
    role_attr_flags: CREATEDB,SUPERUSER
  become: yes
  become_user: postgres


- name: create deployer database
  postgresql_db: name="{{ deployer }}" encoding="UTF-8"
  become: yes
  become_user: postgres
